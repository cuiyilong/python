#!/usr/bin/env python

import os, struct

ARPReqBuff = '\x00\x01\x08\x00\x06\x04\x00\x01\x44\x37\xe6\x96\xe2\xab\xc0\xa8\x01\x01\x00\x00\x00'\
             '\x00\x00\x00\xc0\xa8\x01\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'\
			 '\x00\x00\x00\x00'
ARPReplyBuff = '\x44\x37\xe6\x96\xe2\xab\xb8\xc8\x55\xac\x03\x89\x08\x06\x00\x01\x08\x00\x06\x04\x00'\
               '\x02\xb8\xc8\x55\xac\x03\x89\xc0\xa8\x01\x0a\x44\x37\xe6\x96\xe2\xab\xc0\xa8\x02\x01'\
               '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
			 
CWDisBuff = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\xa5\x00\x00\x14\x00\x01\x00\x00'\
            '\x26\x00\x44\x00\x00\x70\x33\x00\x00\x00\x11\x4e\x32\x30\x30\x2d'\
            '\x47\x41\x32\x30\x30\x69\x2d\x41\x47\x4e\x32\x32\x00\x01\x00\x0c'\
            '\x31\x30\x30\x30\x31\x30\x30\x30\x30\x30\x30\x31\x00\x02\x00\x07'\
            '\x76\x31\x2e\x30\x2e\x30\x20\x00\x03\x00\x02\x76\x35\x00\x04\x00'\
            '\x06\x00\x00\x00\x00\x00\x01\x00\x27\x00\x35\x02\x02\x01\x01\x00'\
            '\x0c\x00\x00\x70\x33\x00\x00\x00\x02\x76\x35\x00\x00\x70\x33\x00'\
            '\x01\x00\x0e\x61\x70\x37\x2e\x30\x2d\x31\x30\x31\x38\x2d\x37\x30'\
            '\x31\x00\x00\x70\x33\x00\x22\x00\x07\x76\x31\x2e\x30\x2e\x30\x20'\
            '\x00\x29\x00\x01\x0e\x00\x2c\x00\x01\x00\x04\x18\x00\x05\x01\x00'\
            '\x00\x00\x0a\x04\x18\x00\x05\x02\x00\x00\x00\x0c'

CWJoinBuff = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x01\x3e\x00'\
             '\x00\x1c\x00\x01\x30\x00\x26\x00\x44\x00\x00\x70\x33\x00\x00\x00'\
             '\x11\x4e\x32\x30\x30\x2d\x47\x41\x32\x30\x30\x69\x2d\x41\x47\x4e'\
             '\x32\x32\x00\x01\x00\x0c\x31\x30\x30\x30\x31\x30\x30\x30\x30\x30'\
             '\x30\x31\x00\x02\x00\x07\x76\x31\x2e\x30\x2e\x30\x20\x00\x03\x00'\
             '\x02\x76\x35\x00\x04\x00\x06\x00\x00\x00\x00\x00\x01\x00\x27\x00'\
             '\x35\x02\x02\x01\x01\x00\x0c\x00\x00\x70\x33\x00\x00\x00\x02\x76'\
             '\x35\x00\x00\x70\x33\x00\x01\x00\x0e\x61\x70\x37\x2e\x30\x2d\x31'\
             '\x30\x31\x38\x2d\x37\x30\x31\x00\x00\x70\x33\x00\x02\x00\x07\x76'\
             '\x31\x2e\x30\x2e\x30\x20\x00\x2d\x00\x02\x61\x70\x00\x23\x00\x10'\
             '\x00\x00\x00\x00\x00\x01\x38\x5f\x3e\xf3\xe5\xc9\x5f\x18\x9d\xda'\
             '\x00\x29\x00\x01\x0e\x00\x2c\x00\x01\x02\x00\x1e\x00\x04\x64\x01'\
             '\x00\xc8\x04\x18\x00\x05\x01\x00\x00\x00\x0a\x04\x18\x00\x05\x02'\
             '\x00\x00\x00\x0d\x00\x25\x00\x2b\x00\x00\x00\x00\x00\xa3\x00\x23'\
             '\x00\x02\x00\x38\x00\x02\x00\x10\x00\x00\x00\x00\x43\x50\x55\x20'\
             '\x4d\x6f\x64\x65\x6c\x20\x61\x6e\x64\x20\x46\x72\x65\x71\x75\x65'\
             '\x6e\x63\x79\x00\x25\x00\x14\x00\x00\x00\x00\x00\xb4\x00\x0c\x00'\
             '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x25\x00\x2c\x00'\
             '\x00\x00\x00\x00\xb5\x00\x24\x00\x00\x00\x00\x00\x00\x00\x00\x00'\
             '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'\
             '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

CWConfigStat = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x01\x01\x1d\x00'\
               '\x00\x04\x00\x08\x67\x62\x63\x6f\x6d\x41\x43\x35\x00\x1f\x00\x02'\
               '\x01\x01\x00\x1f\x00\x02\x02\x01\x00\x24\x00\x02\x00\x78\x00\x30'\
               '\x00\x0f\x00\x23\x00\x00\x00\x00\x02\x73\x00\x00\x00\x00\x00\x00'\
               '\x05\x04\x04\x00\x08\x02\x00\x01\x01\x00\x00\x00\x00\x04\x10\x00'\
               '\x09\x01\x8c\x92\x98\xa4\xb0\x48\x60\x6c\x04\x10\x00\x0d\x02\x82'\
               '\x84\x8b\x96\x8c\x12\x18\x24\x30\x48\x60\x6c\x04\x16\x00\x10\x01'\
               '\x01\x10\x01\x00\x00\x00\x00\x00\x01\x00\xc8\x43\x4e\x00\x00\x04'\
               '\x16\x00\x10\x02\x01\x10\x01\x00\x00\x00\x00\x00\x00\x00\xc8\x43'\
               '\x4e\x00\x00\x04\x11\x00\x04\x01\x00\x00\x14\x04\x11\x00\x04\x02'\
               '\x00\x00\x14\x04\x18\x00\x05\x01\x00\x00\x00\x0a\x04\x18\x00\x05'\
               '\x02\x00\x00\x00\x0d\x04\x09\x00\x08\x01\x00\x95\x04\x00\x00\x00'\
               '\x55\x00\x25\x00\x1f\x00\x00\x00\x00\x00\xa1\x00\x17\x00\x00\x00'\
               '\x01\x00\x00\x00\x47\x00\x00\x05\xdc\x00\x00\x00\x00\x00\x01\x77'\
               '\x69\x66\x69\x30\x00\x25\x00\x1f\x00\x00\x00\x00\x00\xa1\x00\x17'\
               '\x00\x00\x00\x02\x00\x00\x00\x47\x00\x00\x05\xdc\x00\x34\xcb\xb0'\
               '\x2b\xed\x77\x69\x66\x69\x31\x00\x25\x00\x1f\x00\x00\x00\x00\x00'\
               '\xa1\x00\x17\x00\x00\x00\x03\x00\x00\x00\x06\x00\x00\x05\xdc\xac'\
               '\x34\xcb\xb0\x2b\xee\x70\x6f\x72\x74\x30'


CWChangeStat = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x02\x00\x19\x00'\
               '\x00\x20\x00\x03\x01\x01\x00\x00\x20\x00\x03\x02\x01\x00\x00\x21'\
               '\x00\x04\x00\x00\x00\x00'

#with not session id
CWKeepalive =  '\x00\x10\x00\x08\x00\x00\x00\x00\x00\x16\x00\x23\x00\x10'

CWEcho = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0d\x03\x00\x03\x00'

CWConfigUpdateRsp = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x90\x00\x19'\
                    '\x00\x00\x21\x00\x04\x00\x00\x00\x00\x00\x20\x00\x03\x01\x01'\
                    '\x00\x00\x20\x00\x03\x02\x01\x00'

#with not bssid
CWWlanConfigRsp = '\x00\x10\x00\x00\x00\x00\x00\x00\x00\x33\xdd\x02\x01\x00\x17'\
                  '\x00\x00\x21\x00\x04\x00\x00\x00\x00\x04\x02\x00\x08\x02\x01'

CWStationConfigRsp = '\x00\x10\x01\x00\x00\x00\x00\x00\x00\x00\x00\x1a\x02\x00\x0b'\
                     '\x00\x00\x21\x00\x04\x00\x00\x00\x00'
					 
OpenStaAuth = '\x00\x20\x43\x20\x00\x00\x00\x00\x04\xcc\x00\x00\x00\x00\x00\x00\xb0'\
              '\x00\x3c\x00\x00\x00\x00\x00\x00\x01\x40\xe7\xd8\x6c\x01\x01\x00\x00'\
              '\x00\x00\x00\x01\xf0\x88\x00\x00\x01\x00\x00\x00'
			  
OpenStaAssociateReq = '\x00\x20\x43\x20\x00\x00\x00\x00\x04\x2c\x00\x00\x00\x00\x00'\
                      '\x00\x00\x00\x3c\x00\x00\x00\x00\x00\x00\x01\x40\xe7\xd8\x6c'\
                      '\x01\x01\x00\x00\x00\x00\x00\x01\x00\x89\x21\x04\x14\x00\x00'\
                      '\x0c\x67\x62\x63\x6f\x6d\x5f\x67\x5f\x74\x65\x73\x74\x01\x08'\
                      '\x82\x84\x8b\x96\x0c\x12\x18\x24\x32\x04\x30\x48\x60\x6c\xdd'\
                      '\x07\x00\x50\xf2\x02\x00\x01\x00\x2d\x1a\x30\x09\x17\xff\x00'\
                      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'\
                      '\x00\x00\x00\x00\x00\x00'
					  
PeapStaAuth = '\x00\x20\x43\x20\x00\x00\x00\x00\x04\xcc\x00\x00\x00\x00\x00\x00\xb0'\
              '\x00\x3c\x00\x00\x00\x00\x00\x00\x01\x40\xe7\xd8\x6c\x01\x01\x00\x00'\
              '\x00\x00\x00\x01\x90\x08\x00\x00\x01\x00\x00\x00'

PeapStaAssociateReq = '\x00\x20\x43\x20\x00\x00\x00\x00\x04\x2c\x00\x00\x00\x00\x00'\
                      '\x00\x00\x00\x3c\x00\x00\x00\x00\x00\x00\x01\x40\xe7\xd8\x6c'\
                      '\x01\x01\x00\x00\x00\x00\x00\x01\xc0\x01\x21\x04\x0a\x00\x00'\
                      '\x0c\x67\x62\x63\x6f\x6d\x5f\x67\x5f\x74\x65\x73\x74\x01\x08'\
                      '\x82\x84\x8b\x96\x24\x30\x48\x6c\x21\x02\x0a\x11\x24\x02\x01'\
                      '\x0d\x32\x04\x0c\x12\x18\x60\x2d\x1a\x2c\x18\x1b\xff\x00\x00'\
	                  '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'\
                      '\x00\x00\x00\x00\x00\xdd\x09\x00\x10\x18\x02\x00\x10\x01\x00'\
                      '\x00\xdd\x1e\x00\x90\x4c\x33\x2c\x18\x1b\xff\x00\x00\x00\x00'\
                      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'\
                      '\x00\x00\x00\x30\x14\x01\x00\x00\x0f\xac\x04\x01\x00\x00\x0f'\
                      '\xac\x04\x01\x00\x00\x0f\xac\x01\x00\x00\xdd\x07\x00\x50\xf2'\
                      '\x02\x00\x01\x00'

PeapStaEapStart = '\x00\x20\x42\x10\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x01\x00'\
                  '\xff\xff\xff\xff\xff\xff\x40\xe7\xd8\x6c\x01\x01\x88\x8e\x01\x01'\
                  '\x00\x00\x00'

PortalChallengeReq = '\x01\x01\x00\x00\x00\x01\x00\x00\xac\xa8\x01\x02\x00\x00\x00\x00'

PortalAuthReq = '\x01\x03\x00\x00\x00\x02\x00\x06\xac\xa8\x01\x02\x00\x00\x00\x02\x01'\
                '\x03\x31\x04\x12\x83\xf5\x3d\x0e\x66\xca\x37\x26\xf1\x00\x2b\x0b\x58\x7d\x74\xaf'

PortalAuthAff = '\x01\x07\x00\x00\x00\x02\x00\x06\xac\xa8\x01\x02\x00\x00\x00\x00'

confDict = {}

def macs2a(mac):
    dict = {'0':0, '1':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9,\
           'a':10, 'b':11, 'c':12, 'd':13, 'e':14, 'f':15}
    mac = mac.lower()
    tmp = mac.split(':')
    res = ''
    for i in range(len(tmp)):
        uc = struct.pack('B', 16*dict[tmp[i][0]] + dict[tmp[i][1]])
        res = res + uc
    return res


def env_init():
    arpDelay = '3600'
    arpDelayPath = '/proc/sys/net/ipv4/neigh/' + confDict['HostDev'] + '/base_reachable_time'
    sendRedirectPath = '/proc/sys/net/ipv4/conf/' + confDict['HostDev'] + '/send_redirects'
    acceptRedirectPath = '/proc/sys/net/ipv4/conf/' + confDict['HostDev'] + '/accept_redirects'
    ret = os.system('echo ' + arpDelay + ' > ' + arpDelayPath)
    if ret != 0:
        print 'Error : set arp delay time failed.'
        return -1
	
    ret = os.system('echo 0 > ' + sendRedirectPath)
    if ret != 0:
        print 'Error : close send redirect failed.'
        return -1
    ret = os.system('echo 0 > ' + acceptRedirectPath)
    if ret != 0:
        print 'Error : close send redirect failed.'
        return -1
		
    ret = os.system('gcc ./md5.c -fPIC -shared -o libmd5.so')
    if ret != 0:
        print 'Error : create libmd5.so failed.'
        return -1
    return 0	

def readConf():
    confPath = os.path.join(os.getcwd(), 'configure')

    if not os.path.isfile(confPath):
        print('configure file [' + confPath + '] not exist')
        return False
    fp = open(confPath, 'r')

    try:
        line = fp.readline()
        while line:
            line = line.strip(' \t\n')
            if line and not line.startswith('#'):
                list = line.split('=')
                list[0] = list[0].strip()
                list[1] = list[1].strip()
                confDict[list[0]] = list[1]

            line = fp.readline()
    finally:
        fp.close()


readConf()
ret = env_init()
if ret == -1:
    exit(1)
